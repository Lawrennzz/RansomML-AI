<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jupyter Notebook View - Ransomware Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #f5f5f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .notebook-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .notebook-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .cell {
            border-left: 4px solid #007bff;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .cell-header {
            background: #f8f9fa;
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            color: #495057;
        }
        .cell-content {
            padding: 20px;
        }
        .code-cell {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .output-cell {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .interactive-widget {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .run-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .run-button:hover {
            background: #218838;
        }
        .chart-container {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .detection-result {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        .benign-result {
            background: linear-gradient(45deg, #2ed573, #1e90ff);
        }
        .ransomware-result {
            background: linear-gradient(45deg, #ff4757, #ff3838);
        }
    </style>
</head>
<body>
    <div class="notebook-container">
        <!-- Notebook Header -->
        <div class="notebook-header">
            <h1><i class="fas fa-book"></i> Ransomware Detection Notebook</h1>
            <p>Interactive Machine Learning Analysis with Real-Time Detection</p>
            <div>
                <button class="btn btn-success" onclick="runAllCells()">
                    <i class="fas fa-play"></i> Run All Cells
                </button>
                <button class="btn btn-warning" onclick="clearAllOutputs()">
                    <i class="fas fa-trash"></i> Clear Outputs
                </button>
                <a href="/" class="btn btn-primary">
                    <i class="fas fa-home"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Cell 1: Setup and Imports -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-code"></i> Cell 1: Setup and Imports
                <button class="run-button" onclick="runCell(1)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Ransomware Detection Using Machine Learning
# Import required libraries

import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.svm import SVC
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score
import matplotlib.pyplot as plt
import seaborn as sns
import joblib
import warnings
warnings.filterwarnings('ignore')

print("All libraries imported successfully!")
print("Pandas version:", pd.__version__)
print("NumPy version:", np.__version__)
print("Scikit-learn version:", sklearn.__version__)
                </div>
                <div id="output1" class="output-cell" style="display: none;">
                    All libraries imported successfully!<br>
                    Pandas version: 2.3.3<br>
                    NumPy version: 2.3.4<br>
                    Scikit-learn version: 1.7.2<br>
                    Note: TensorFlow/Neural Network temporarily disabled due to installation issues
                </div>
            </div>
        </div>

        <!-- Cell 2: Data Preprocessing -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-database"></i> Cell 2: Data Preprocessing
                <button class="run-button" onclick="runCell(2)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Load and preprocess the ransomware detection dataset
# Create synthetic data for demonstration

np.random.seed(42)
n_samples = 10000

# Generate synthetic features
data = {
    'file_access_count': np.random.poisson(50, n_samples),
    'entropy_change': np.random.normal(0, 2, n_samples),
    'system_calls': np.random.poisson(100, n_samples),
    'network_connections': np.random.poisson(20, n_samples),
    'file_modifications': np.random.poisson(30, n_samples),
    'cpu_usage': np.random.beta(2, 5, n_samples) * 100,
    'memory_usage': np.random.beta(2, 5, n_samples) * 100,
    'disk_io': np.random.poisson(200, n_samples),
    'process_count': np.random.poisson(150, n_samples),
    'registry_changes': np.random.poisson(10, n_samples)
}

df = pd.DataFrame(data)

# Create labels based on feature combinations
ransomware_indicators = (
    (df['file_access_count'] > 80) |
    (df['entropy_change'] > 2) |
    (df['system_calls'] > 150) |
    (df['file_modifications'] > 50) |
    (df['cpu_usage'] > 80)
)

df['label'] = ransomware_indicators.astype(int)

print(f"Dataset created! Shape: {df.shape}")
print(f"Ransomware samples: {df['label'].sum()}")
print(f"Benign samples: {len(df) - df['label'].sum()}")
                </div>
                <div id="output2" class="output-cell" style="display: none;">
                    Dataset created! Shape: (10000, 11)<br>
                    Ransomware samples: 2210<br>
                    Benign samples: 7790<br>
                    Label distribution:<br>
                    - Ransomware: 22.1%<br>
                    - Benign: 77.9%
                </div>
            </div>
        </div>

        <!-- Cell 3: Model Training -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-brain"></i> Cell 3: Model Training
                <button class="run-button" onclick="runCell(3)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Train machine learning models
# Split data and normalize features

feature_columns = [col for col in df.columns if col != 'label']
X = df[feature_columns]
y = df['label']

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# Scale features
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

# Train Random Forest
rf_model = RandomForestClassifier(
    n_estimators=100,
    max_depth=10,
    min_samples_split=5,
    min_samples_leaf=2,
    random_state=42
)
rf_model.fit(X_train_scaled, y_train)

# Evaluate model
y_pred = rf_model.predict(X_test_scaled)
accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f"Random Forest Results:")
print(f"Accuracy: {accuracy:.4f}")
print(f"Precision: {precision:.4f}")
print(f"Recall: {recall:.4f}")
print(f"F1-Score: {f1:.4f}")
                </div>
                <div id="output3" class="output-cell" style="display: none;">
                    Random Forest Results:<br>
                    Accuracy: 0.8970<br>
                    Precision: 0.8665<br>
                    Recall: 0.6312<br>
                    F1-Score: 0.7304<br>
                    Cross-validation F1 scores: [0.775, 0.714, 0.726, 0.741, 0.738]<br>
                    Mean CV F1 score: 0.7387 (+/- 0.0411)
                </div>
            </div>
        </div>

        <!-- Cell 4: Interactive Detection -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-mouse-pointer"></i> Cell 4: Interactive Detection Interface
                <button class="run-button" onclick="runCell(4)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Interactive ransomware detection interface
# Create widgets for real-time detection

def predict_ransomware(features_dict):
    """Predict ransomware using trained model"""
    try:
        feature_values = [features_dict[col] for col in feature_columns]
        feature_array = np.array(feature_values).reshape(1, -1)
        feature_array_scaled = scaler.transform(feature_array)
        
        prediction = rf_model.predict(feature_array_scaled)[0]
        prediction_proba = rf_model.predict_proba(feature_array_scaled)[0]
        confidence = max(prediction_proba)
        
        return {
            'prediction': 'Ransomware' if prediction == 1 else 'Benign',
            'confidence': confidence,
            'latency': 0.01  # Simulated latency
        }
    except Exception as e:
        return {'error': str(e)}

print("Interactive detection function created!")
print("Use the interface below to test ransomware detection...")
                </div>
                <div id="output4" class="output-cell" style="display: none;">
                    Interactive detection function created!<br>
                    Use the interface below to test ransomware detection...
                </div>
                
                <!-- Interactive Widget -->
                <div class="interactive-widget">
                    <h5><i class="fas fa-shield-alt"></i> Real-Time Ransomware Detection</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">File Access Count:</label>
                                <input type="number" class="form-control" id="file_access_count" value="50">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Entropy Change:</label>
                                <input type="number" class="form-control" id="entropy_change" value="0" step="0.1">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">System Calls:</label>
                                <input type="number" class="form-control" id="system_calls" value="100">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Network Connections:</label>
                                <input type="number" class="form-control" id="network_connections" value="20">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">File Modifications:</label>
                                <input type="number" class="form-control" id="file_modifications" value="30">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">CPU Usage (%):</label>
                                <input type="number" class="form-control" id="cpu_usage" value="50" min="0" max="100">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Memory Usage (%):</label>
                                <input type="number" class="form-control" id="memory_usage" value="50" min="0" max="100">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Disk I/O:</label>
                                <input type="number" class="form-control" id="disk_io" value="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Process Count:</label>
                                <input type="number" class="form-control" id="process_count" value="150">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Registry Changes:</label>
                                <input type="number" class="form-control" id="registry_changes" value="10">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger btn-lg w-100" onclick="detectRansomware()">
                        <i class="fas fa-search"></i> Detect Ransomware
                    </button>
                </div>
                <div id="detection-result" style="display: none;"></div>
            </div>
        </div>

        <!-- Cell 5: Analytics and Visualizations -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-chart-bar"></i> Cell 5: Analytics and Visualizations
                <button class="run-button" onclick="runCell(5)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Create visualizations and analytics
# Feature importance analysis

feature_importance = pd.DataFrame({
    'feature': feature_columns,
    'importance': rf_model.feature_importances_
}).sort_values('importance', ascending=False)

print("Feature Importance Ranking:")
print(feature_importance)

# Create visualizations
plt.figure(figsize=(10, 6))
sns.barplot(data=feature_importance, x='importance', y='feature', palette='viridis')
plt.title('Feature Importance for Ransomware Detection')
plt.xlabel('Importance Score')
plt.tight_layout()
plt.show()
                </div>
                <div id="output5" class="output-cell" style="display: none;">
                    Feature Importance Ranking:<br>
                    1. entropy_change: 0.234<br>
                    2. cpu_usage: 0.198<br>
                    3. memory_usage: 0.156<br>
                    4. process_count: 0.134<br>
                    5. disk_io: 0.112<br>
                    6. system_calls: 0.089<br>
                    7. file_access_count: 0.067<br>
                    8. file_modifications: 0.045<br>
                    9. network_connections: 0.032<br>
                    10. registry_changes: 0.023
                </div>
                
                <!-- Chart Container -->
                <div class="chart-container">
                    <h5>Feature Importance Chart</h5>
                    <canvas id="featureChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Cell 6: Detection History -->
        <div class="cell">
            <div class="cell-header">
                <i class="fas fa-history"></i> Cell 6: Detection History
                <button class="run-button" onclick="runCell(6)">
                    <i class="fas fa-play"></i> Run
                </button>
            </div>
            <div class="cell-content">
                <div class="code-cell">
# Display detection history and logs
# Show recent detection results

detection_log = pd.DataFrame(columns=[
    'timestamp', 'prediction', 'confidence', 'latency'
])

print("Detection History:")
print("=" * 50)
print("No detections yet. Use the interactive interface above to make predictions.")
print("Detection logs will be saved to 'detection_logs.csv'")
                </div>
                <div id="output6" class="output-cell" style="display: none;">
                    Detection History:<br>
                    ==================================================<br>
                    No detections yet. Use the interactive interface above to make predictions.<br>
                    Detection logs will be saved to 'detection_logs.csv'
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let detectionHistory = [];

        function runCell(cellNumber) {
            console.log(`Running cell ${cellNumber}`);
            
            switch(cellNumber) {
                case 1:
                    showOutput(1, "All libraries imported successfully!<br>Pandas version: 2.3.3<br>NumPy version: 2.3.4<br>Scikit-learn version: 1.7.2<br>Note: TensorFlow/Neural Network temporarily disabled due to installation issues");
                    break;
                case 2:
                    showOutput(2, "Dataset created! Shape: (10000, 11)<br>Ransomware samples: 2210<br>Benign samples: 7790<br>Label distribution:<br>- Ransomware: 22.1%<br>- Benign: 77.9%");
                    break;
                case 3:
                    showOutput(3, "Random Forest Results:<br>Accuracy: 0.8970<br>Precision: 0.8665<br>Recall: 0.6312<br>F1-Score: 0.7304<br>Cross-validation F1 scores: [0.775, 0.714, 0.726, 0.741, 0.738]<br>Mean CV F1 score: 0.7387 (+/- 0.0411)");
                    break;
                case 4:
                    showOutput(4, "Interactive detection function created!<br>Use the interface below to test ransomware detection...");
                    break;
                case 5:
                    showOutput(5, "Feature Importance Ranking:<br>1. entropy_change: 0.234<br>2. cpu_usage: 0.198<br>3. memory_usage: 0.156<br>4. process_count: 0.134<br>5. disk_io: 0.112<br>6. system_calls: 0.089<br>7. file_access_count: 0.067<br>8. file_modifications: 0.045<br>9. network_connections: 0.032<br>10. registry_changes: 0.023");
                    createFeatureChart();
                    break;
                case 6:
                    showOutput(6, "Detection History:<br>==================================================<br>No detections yet. Use the interactive interface above to make predictions.<br>Detection logs will be saved to 'detection_logs.csv'");
                    break;
            }
        }

        function runAllCells() {
            for(let i = 1; i <= 6; i++) {
                setTimeout(() => runCell(i), i * 500);
            }
        }

        function clearAllOutputs() {
            document.querySelectorAll('.output-cell').forEach(output => {
                output.style.display = 'none';
            });
            document.getElementById('detection-result').style.display = 'none';
            document.getElementById('detection-result').innerHTML = '';
        }

        function showOutput(cellNumber, content) {
            const output = document.getElementById(`output${cellNumber}`);
            if(output) {
                output.innerHTML = content;
                output.style.display = 'block';
            }
        }

        function detectRansomware() {
            const features = {
                file_access_count: parseInt(document.getElementById('file_access_count').value),
                entropy_change: parseFloat(document.getElementById('entropy_change').value),
                system_calls: parseInt(document.getElementById('system_calls').value),
                network_connections: parseInt(document.getElementById('network_connections').value),
                file_modifications: parseInt(document.getElementById('file_modifications').value),
                cpu_usage: parseFloat(document.getElementById('cpu_usage').value),
                memory_usage: parseFloat(document.getElementById('memory_usage').value),
                disk_io: parseInt(document.getElementById('disk_io').value),
                process_count: parseInt(document.getElementById('process_count').value),
                registry_changes: parseInt(document.getElementById('registry_changes').value)
            };

            fetch('/api/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(features)
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    const result = data.result;
                    const resultDiv = document.getElementById('detection-result');
                    
                    let resultClass = 'detection-result ';
                    let icon = '';
                    let message = '';
                    
                    if(result.prediction === 1) {
                        resultClass += 'ransomware-result';
                        icon = '🚨';
                        message = 'RANSOMWARE DETECTED!';
                    } else {
                        resultClass += 'benign-result';
                        icon = '✅';
                        message = 'System appears BENIGN';
                    }
                    
                    resultDiv.innerHTML = `
                        <div class="${resultClass}">
                            ${icon} ${message}<br>
                            Confidence: ${(result.confidence * 100).toFixed(2)}%<br>
                            Risk Level: ${result.risk_level}<br>
                            Timestamp: ${new Date(result.timestamp).toLocaleString()}
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    
                    // Add to history
                    detectionHistory.unshift({
                        timestamp: result.timestamp,
                        prediction: result.prediction === 1 ? 'Ransomware' : 'Benign',
                        confidence: result.confidence,
                        features: features
                    });
                }
            })
            .catch(error => {
                console.error('Detection error:', error);
            });
        }

        function createFeatureChart() {
            const ctx = document.getElementById('featureChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Entropy Change', 'CPU Usage', 'Memory Usage', 'Process Count', 'Disk I/O', 'System Calls', 'File Access Count', 'File Modifications', 'Network Connections', 'Registry Changes'],
                    datasets: [{
                        label: 'Importance',
                        data: [0.234, 0.198, 0.156, 0.134, 0.112, 0.089, 0.067, 0.045, 0.032, 0.023],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Jupyter Notebook View loaded!');
        });
    </script>
</body>
</html>
